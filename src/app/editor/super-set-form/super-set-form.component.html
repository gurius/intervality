<form
  class="flex flex-col justify-center gap-3 text-container"
  [formGroup]="supersetForm"
>
  <div class="flex gap-3">
    <div class="flex min-w-32 flex-1 grow-4 flex-col">
      <label for="set-name">Superset name</label>
      <input class="w-full" type="text" formControlName="name" id="set-name" />
    </div>
    <div class="reps mb-6 flex min-w-3 flex-1 flex-col">
      <label for="set-repetitions">Reps</label>
      <input
        class="w-full"
        type="number"
        step="1"
        formControlName="repetitions"
        id="set-repetitions"
      />
    </div>
  </div>
  <div formArrayName="setsAndTimers">
    @for (
      stGroup of setsAndTimersArray.controls;
      track stIdx;
      let stIdx = $index
    ) {
      @if (getIsSet(stIdx)) {
        <app-set-form
          class="mb-5 overflow-hidden rounded-xl border-2 border-secondary p-2"
          #submit
          [set]="getSetMeta(stIdx)"
          [setForm]="stGroup"
        >
          <div
            class="heading heading -mx-2 -mt-5 flex w-full flex-shrink flex-grow items-center justify-between bg-container pl-4 text-on-container"
          >
            #{{ stIdx + 1 }}
            <h3>Set</h3>
            <button
              type="button"
              class="h-12 w-14 self-end"
              (click)="removeItem(stIdx)"
            >
              <i class="fa-solid fa-rectangle-xmark"></i>
            </button>
          </div>

          <app-timers-form-array
            [group]="stGroup"
            [timers]="getSetMeta(stIdx).timers"
          ></app-timers-form-array>
        </app-set-form>
      } @else {
        <app-timer-form
          [idx]="stIdx"
          [group]="stGroup"
          [timer]="getTimersMeta(stIdx)"
        >
          <div
            class="heading heading -mx-2 -mt-2 flex w-full flex-shrink flex-grow items-center justify-between bg-container pl-4 text-on-container"
          >
            #{{ stIdx + 1 }}
            <h3>Timer</h3>
            <button
              type="button"
              class="h-12 w-14 self-end"
              (click)="removeItem(stIdx)"
            >
              <i class="fa-solid fa-rectangle-xmark"></i>
            </button>
          </div>
        </app-timer-form>
      }
    }
  </div>

  <div
    title="add"
    type="button"
    (click)="openAddMenu()"
    class="{{
      isAddMenuVisible ? 'h-36' : 'h-12'
    }} w-full rounded-md border-2 border-dashed border-secondary flex justify-center items-center"
  >
    @if (isAddMenuVisible) {
      <div class="flex flex-wrap items-center justify-center gap-3 px-6">
        <button
          title="add stopwatch"
          (click)="addTimer($event, 'stopwatch')"
          type="button"
          class="rounded-3xl border-2 border-secondary px-3 py-1"
        >
          <i class="fa-solid fa-stopwatch"></i>
          <label class="pl-1">new </label>
        </button>
        <button
          title="add countdown"
          (click)="addTimer($event, 'countdown')"
          type="button"
          class="rounded-3xl border-2 border-secondary px-3 py-1"
        >
          <i class="fa-solid fa-hourglass-start"></i>
          <label class="pl-1">new</label>
        </button>
        <!-- TODO: show a set of what can be added depending on the context -->
        <button
          (click)="addTimer($event, 'set')"
          type="button"
          class="rounded-3xl border-2 border-secondary px-3 py-1"
        >
          <i class="fa-solid fa-bars"></i>
          <label class="pl-1">new</label>
        </button>
        <!-- <button -->
        <!--   (click)="addTimer($event)" -->
        <!--   type="button" -->
        <!--   class="rounded-3xl border-2 border-secondary px-3 py-1" -->
        <!-- > -->
        <!--   <i class="fa-brands fa-web-awesome"></i> -->
        <!--   <label class="pl-1">SS</label> -->
        <!-- </button> -->

        <div class="flex flex-col">
          <select title="add existing" id="existing" class="rounded-3xl">
            @for (opt of existingTimers; track opt.value) {
              <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        </div>
      </div>
    } @else {
      <i class="fa-solid fa-plus"></i>
    }
  </div>
</form>
